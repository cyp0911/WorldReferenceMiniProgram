<view class="page">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header bg-blue-600 text-white">
    <view class="container">
      <view class="py-4">
        <view class="text-xl font-bold text-center">ä¸–ç•Œå‚è€ƒæ¶ˆæ¯</view>
        <view class="text-sm text-blue-100 text-center mt-1">å…¨çƒå®æ—¶æ¶ˆæ¯è¿½è¸ª</view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯æ  -->
  <view class="container">
    <view class="card card-shadow mt-4">
      <view class="flex justify-between items-center">
        <view class="flex items-center">
          <view class="bg-blue-100 rounded-full p-2 mr-3">
            <text class="text-blue-600 font-bold">ä»Šæ—¥</text>
          </view>
          <view>
            <view class="text-sm text-gray-600">æ–°å¢æ¶ˆæ¯</view>
            <view class="text-xl font-bold text-blue-600">{{todayUnreadCount}}</view>
          </view>
        </view>
        <view class="flex items-center">
          <view class="bg-green-100 rounded-full p-2 mr-3">
            <text class="text-green-600 font-bold">å…¨çƒ</text>
          </view>
          <view>
            <view class="text-sm text-gray-600">è¦†ç›–å›½å®¶</view>
            <view class="text-xl font-bold text-green-600">{{countryCount}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸–ç•Œåœ°å›¾å®¹å™¨ -->
  <view class="container mt-4">
    <view class="card card-shadow p-4">
      <view class="map-container relative">
        <!-- ä¸–ç•Œåœ°å›¾èƒŒæ™¯ -->
        <view class="world-map relative">
          <!-- ç®€åŒ–çš„ä¸–ç•Œåœ°å›¾è½®å»“ -->
          <view class="map-outline">
            <!-- åŒ—ç¾æ´² -->
            <view class="continent continent-north-america"></view>
            <!-- å—ç¾æ´² -->
            <view class="continent continent-south-america"></view>
            <!-- æ¬§æ´² -->
            <view class="continent continent-europe"></view>
            <!-- éæ´² -->
            <view class="continent continent-africa"></view>
            <!-- äºšæ´² -->
            <view class="continent continent-asia"></view>
            <!-- å¤§æ´‹æ´² -->
            <view class="continent continent-oceania"></view>
          </view>
          
          <!-- å›½å®¶æ ‡è®°å±‚ -->
          <view class="markers-layer">
            <view
              class="country-marker"
              wx:for="{{countries}}"
              wx:key="id"
              data-country="{{item}}"
              bindtap="onCountryTap"
              style="left: {{item.position.x}}%; top: {{item.position.y}}%;"
            >
              <!-- è„‰å†²åŠ¨ç”»åœ†åœˆ -->
              <view class="ping-animation absolute w-8 h-8 bg-blue-400 rounded-full opacity-75" wx:if="{{item.unreadCount > 0}}"></view>
              <!-- ä¸»æ ‡è®°ç‚¹ -->
              <view class="marker-dot bg-blue-600 rounded-full w-8 h-8 flex items-center justify-center shadow-md">
                <text class="text-white text-xs font-bold">{{item.unreadCount}}</text>
              </view>
              <!-- æ‚¬åœæç¤º -->
              <view class="marker-tooltip absolute bg-gray-800 text-white text-xs px-2 py-1 rounded mt-1 whitespace-nowrap opacity-0 transition-opacity" style="top: 100%; left: 50%; transform: translateX(-50%);">
                {{item.flag}} {{item.name}}
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å›½å®¶/åœ°åŒºåˆ—è¡¨ -->
  <view class="container mt-4 mb-20">
    <view class="mb-3">
      <view class="text-lg font-semibold text-gray-900">å›½å®¶åˆ—è¡¨</view>
      <view class="text-sm text-gray-600">æŒ‰æœªè¯»æ•°é‡æ’åº</view>
    </view>
    
    <view class="space-y-3">
      <view
        class="card shadow-sm"
        wx:for="{{sortedCountries}}"
        wx:key="id"
        bindtap="onCountryTap"
        data-country="{{item}}"
      >
        <view class="flex items-center justify-between">
          <view class="flex items-center flex-1">
            <!-- å›½æ—— -->
            <view class="text-2xl mr-3">{{item.flag}}</view>
            <!-- å›½å®¶ä¿¡æ¯ -->
            <view class="flex-1">
              <view class="font-semibold text-gray-900">{{item.name}}</view>
              <view class="text-sm text-gray-600">{{item.unreadCount}} æ¡æœªè¯»æ¶ˆæ¯</view>
            </view>
          </view>
          <!-- æœªè¯»æ•°é‡æ ‡ç­¾ -->
          <view class="bg-blue-600 text-white rounded-full px-3 py-1 min-w-[60rpx] text-center">
            <text class="text-sm font-bold">{{item.unreadCount}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ–°é—»åˆ—è¡¨å¼¹çª— -->
  <view class="modal-overlay fixed inset-0 bg-black bg-opacity-50 z-50" wx:if="{{showNewsModal}}" bindtap="closeNewsModal">
    <view class="modal-content fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl animate-slide-up" catchtap="stopPropagation">
      <!-- å¼¹çª—å¤´éƒ¨ -->
      <view class="sticky top-0 bg-white border-b border-gray-200 px-4 py-3 z-10">
        <view class="flex items-center justify-between">
          <view class="flex items-center">
            <text class="text-2xl mr-2" wx:if="{{selectedCountry}}">{{selectedCountry.flag}}</text>
            <view>
              <view class="text-lg font-semibold text-gray-900" wx:if="{{selectedCountry}}">{{selectedCountry.name}}</view>
              <view class="text-sm text-gray-600">ä»Šæ—¥ {{filteredNews.length}} æ¡æ¶ˆæ¯</view>
            </view>
          </view>
          <view class="text-gray-400 text-xl" bindtap="closeNewsModal">Ã—</view>
        </view>
        
        <!-- åˆ†ç±»ç­›é€‰ -->
        <view class="flex space-x-2 mt-3 overflow-x-auto">
          <view 
            class="category-tag {{selectedCategory === 'å…¨éƒ¨' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600'}}"
            wx:for="{{categories}}"
            wx:key="*this"
            bindtap="selectCategory"
            data-category="{{item}}"
          >
            {{item}}
          </view>
        </view>
      </view>
      
      <!-- æ–°é—»åˆ—è¡¨ -->
      <scroll-view class="news-list px-4 py-3 max-h-[70vh]" scroll-y>
        <view 
          class="news-card mb-4 pb-4 border-b border-gray-100 last:border-0"
          wx:for="{{filteredNews}}"
          wx:key="id"
          bindtap="openNewsDetail"
          data-news="{{item}}"
        >
          <!-- ç¬¬ä¸€è¡Œï¼šåª’ä½“ä¿¡æ¯ -->
          <view class="flex items-center justify-between mb-2">
            <view class="flex items-center">
              <text class="text-lg mr-2">{{item.sourceLogo}}</text>
              <text class="text-sm text-gray-700">{{item.source}}</text>
              <text class="text-sm text-gray-500 ml-2">{{item.time}}</text>
            </view>
            <view class="bg-blue-100 text-blue-600 text-xs px-2 py-0.5 rounded">{{item.category}}</view>
          </view>
          
          <!-- ç¬¬äºŒè¡Œï¼šæ–°é—»æ ‡é¢˜ -->
          <view class="text-gray-900 font-medium mb-2 line-clamp-2">{{item.title}}</view>
          
          <!-- ç¬¬ä¸‰è¡Œï¼šç¼©ç•¥å›¾ + é˜…è¯»ä¿¡æ¯ -->
          <view class="flex items-center justify-between">
            <view class="flex items-center space-x-4">
              <text class="text-sm text-gray-500">ğŸ‘ {{item.views}}</text>
              <text class="text-sm text-gray-500">â­ {{item.saved ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
            </view>
            <image wx:if="{{item.image}}" src="{{item.image}}" class="w-16 h-12 rounded object-cover" />
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>