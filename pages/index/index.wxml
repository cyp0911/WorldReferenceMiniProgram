<view class="page">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header">
    <view class="container">
      <view class="py-4">
        <view class="text-xl font-bold text-center">{{pageTitle}}</view>
        <view class="text-sm text-blue-100 text-center mt-1">{{pageSubtitle}}</view>
      </view>
    </view>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <view class="content-area" style="padding-bottom: 140rpx;">
    <!-- åœ°å›¾é¡µé¢å†…å®¹ -->
    <view wx:if="{{activeTab === 'map'}}" class="tab-content">
      <!-- ç»Ÿè®¡ä¿¡æ¯æ  -->
      <view class="container">
        <view class="card card-shadow mt-4">
          <view class="flex justify-between items-center">
            <view class="flex items-center">
              <view class="bg-blue-100 rounded-full p-2 mr-3">
                <text class="text-blue-600 font-bold">ä»Šæ—¥</text>
              </view>
              <view>
                <view class="text-sm text-gray-600">æ–°å¢æ¶ˆæ¯</view>
                <view class="text-xl font-bold text-blue-600">{{todayUnreadCount}}</view>
              </view>
            </view>
            <view class="flex items-center">
              <view class="bg-green-100 rounded-full p-2 mr-3">
                <text class="text-green-600 font-bold">å…¨çƒ</text>
              </view>
              <view>
                <view class="text-sm text-gray-600">è¦†ç›–å›½å®¶</view>
                <view class="text-xl font-bold text-green-600">{{countryCount}}</view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- ä¸–ç•Œåœ°å›¾å®¹å™¨ -->
      <view class="container mt-4">
        <view class="card card-shadow p-4">
          <view class="map-container" style="--map-scale: {{mapScale}};">
            <!-- ç¼©æ”¾æ§åˆ¶æŒ‰é’® -->
            <view class="zoom-controls">
              <view class="zoom-btn zoom-in" bindtap="zoomIn">
                <text>+</text>
              </view>
              <view class="zoom-btn zoom-out" bindtap="zoomOut">
                <text>-</text>
              </view>
              <view class="zoom-btn zoom-reset" bindtap="zoomReset">
                <text>âŸ²</text>
              </view>
            </view>
            
            <!-- ä¸–ç•Œåœ°å›¾èƒŒæ™¯å’Œæ ‡è®°å±‚å®¹å™¨ -->
            <view 
              class="map-content" 
              style="transform: scale({{mapScale}}) translate({{mapTranslateX}}rpx, {{mapTranslateY}}rpx);"
              bindtouchstart="onMapTouchStart"
              bindtouchmove="onMapTouchMove"
              bindtouchend="onMapTouchEnd"
            >
              <!-- ä¸–ç•Œåœ°å›¾èƒŒæ™¯ -->
              <view class="world-map">
                <!-- ç®€åŒ–çš„ä¸–ç•Œåœ°å›¾è½®å»“ -->
                <view class="map-outline">
                  <!-- åŒ—ç¾æ´² -->
                  <view class="continent continent-north-america"></view>
                  <!-- å—ç¾æ´² -->
                  <view class="continent continent-south-america"></view>
                  <!-- æ¬§æ´² -->
                  <view class="continent continent-europe"></view>
                  <!-- éæ´² -->
                  <view class="continent continent-africa"></view>
                  <!-- äºšæ´² -->
                  <view class="continent continent-asia"></view>
                  <!-- å¤§æ´‹æ´² -->
                  <view class="continent continent-oceania"></view>
                </view>
                
                <!-- ä¸–ç•Œåœ°å›¾å›¾æ ‡ -->
                <view class="world-map-icon">ğŸŒ</view>
              </view>
              
              <!-- å›½å®¶æ ‡è®°å±‚ -->
              <view class="markers-layer">
                <view
                  class="country-marker"
                  wx:for="{{countries}}"
                  wx:key="id"
                  bindtap="onCountryTap"
                  bindtouchstart="onMarkerTouchStart"
                  bindtouchend="onMarkerTouchEnd"
                  data-country="{{item}}"
                  data-index="{{index}}"
                  style="left: {{item.position.x}}%; top: {{item.position.y}}%;"
                >
                  <!-- è„‰å†²åŠ¨ç”»åœ†åœˆ -->
                  <view class="ping-animation marker-pulse" wx:if="{{item.unreadCount > 0}}"></view>
                  <!-- ä¸»æ ‡è®°ç‚¹ -->
                  <view class="marker-dot">
                    <text style="color: white; font-size: 24rpx; font-weight: bold;">{{item.unreadCount}}</text>
                  </view>
                  <!-- æ‚¬åœæç¤º -->
                  <view class="marker-tooltip">
                    {{item.flag}} {{item.name}}
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- å›½å®¶/åœ°åŒºåˆ—è¡¨ -->
      <view class="container mt-4 mb-20">
        <view class="mb-3">
          <view class="text-lg font-semibold text-gray-900" style="font-size: 32rpx;">å›½å®¶åˆ—è¡¨</view>
          <view class="text-sm text-gray-600">æŒ‰æœªè¯»æ•°é‡æ’åº</view>
        </view>
        
        <view class="space-y-3">
          <view
            class="card shadow-sm"
            wx:for="{{sortedCountries}}"
            wx:key="id"
            bindtap="onCountryTap"
            data-country="{{item}}"
            style="transition: all 0.15s ease-in-out;"
          >
            <view class="flex justify-between items-center">
              <view class="flex items-center flex-1">
                <!-- å›½æ—— -->
                <view style="font-size: 48rpx; margin-right: 24rpx;">{{item.flag}}</view>
                <!-- å›½å®¶ä¿¡æ¯ -->
                <view class="flex-1">
                  <view style="font-weight: 600; color: #111827; font-size: 28rpx; margin-bottom: 8rpx;">{{item.name}}</view>
                  <view style="color: #4b5563; font-size: 24rpx;">{{item.unreadCount}} æ¡æœªè¯»æ¶ˆæ¯</view>
                </view>
              </view>
              <!-- æœªè¯»æ•°é‡æ ‡ç­¾ -->
              <view style="background-color: #2563eb; color: white; padding: 12rpx 24rpx; border-radius: 50rpx; min-width: 80rpx; text-align: center;">
                <text style="font-size: 24rpx; font-weight: bold;">{{item.unreadCount}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ¨æ€é¡µé¢å†…å®¹ -->
    <view wx:elif="{{activeTab === 'feed'}}" class="tab-content">
      <view class="container mt-4">
        <view class="bg-red-50 rounded-lg p-3" style="border: 1rpx solid #fecaca;">
          <view class="flex items-center">
            <text style="font-size: 40rpx; margin-right: 16rpx;">ğŸ”¥</text>
            <view class="flex-1">
              <view class="text-sm font-semibold" style="color: #b91c1c; font-size: 24rpx;">çƒ­é—¨è¯é¢˜</view>
            </view>
          </view>
          
          <!-- è¯é¢˜æ ‡ç­¾æ¨ªå‘æ»šåŠ¨ -->
          <scroll-view class="topics-scroll mt-2" scroll-x>
            <view class="space-x-2" style="display: flex;">
              <view 
                class="topic-tag {{selectedTopic === item ? 'topic-tag-active' : 'topic-tag-inactive'}}"
                wx:for="{{trendingTopics}}"
                wx:key="*this"
                bindtap="selectTopic"
                data-topic="{{item}}"
              >
                #{{item}}
              </view>
            </view>
          </scroll-view>
        </view>
      </view>

      <view class="container mt-4 mb-20">
        <view class="text-center py-20" style="padding: 160rpx 0;">
          <text style="color: #4b5563; font-size: 28rpx;">åŠ¨æ€é¡µé¢å†…å®¹æ­£åœ¨å¼€å‘ä¸­...</text>
        </view>
      </view>
    </view>

    <!-- æ”¶è—é¡µé¢å†…å®¹ -->
    <view wx:elif="{{activeTab === 'bookmark'}}" class="tab-content">
      <view class="container mt-4 mb-20">
        <view class="text-center py-20" style="padding: 160rpx 0;">
          <text style="font-size: 96rpx; margin-bottom: 32rpx; display: block;">â­</text>
          <view style="color: #111827; font-size: 32rpx; font-weight: 600; margin-bottom: 16rpx;">æˆ‘çš„æ”¶è—</view>
          <view style="color: #4b5563; font-size: 24rpx;">æ”¶è—é¡µé¢å†…å®¹æ­£åœ¨å¼€å‘ä¸­...</view>
        </view>
      </view>
    </view>

    <!-- ä¸ªäººä¸­å¿ƒé¡µé¢å†…å®¹ -->
    <view wx:elif="{{activeTab === 'profile'}}" class="tab-content">
      <view class="container mt-4 mb-20">
        <view class="text-center py-20" style="padding: 160rpx 0;">
          <text style="font-size: 96rpx; margin-bottom: 32rpx; display: block;">ğŸ‘¤</text>
          <view style="color: #111827; font-size: 32rpx; font-weight: 600; margin-bottom: 16rpx;">ä¸ªäººä¸­å¿ƒ</view>
          <view style="color: #4b5563; font-size: 24rpx;">ä¸ªäººä¸­å¿ƒé¡µé¢æ­£åœ¨å¼€å‘ä¸­...</view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å¯¼èˆªæ  -->
  <view class="bottom-nav">
    <view class="flex justify-between items-center py-2" style="padding: 16rpx 0;">
      <!-- åœ°å›¾ Tab -->
      <view 
        class="nav-item {{activeTab === 'map' ? 'nav-item-active' : ''}}"
        bindtap="switchTab"
        bindtouchstart="onTabTouchStart"
        bindtouchend="onTabTouchEnd"
        data-tab="map"
        data-index="0"
      >
        <view class="nav-icon-container">
          <text class="nav-icon {{activeTab === 'map' ? 'icon-active' : 'icon-inactive'}}">ğŸŒ</text>
        </view>
        <text class="nav-label {{activeTab === 'map' ? 'text-blue-600' : 'text-gray-600'}}">åœ°å›¾</text>
      </view>

      <!-- åŠ¨æ€ Tab -->
      <view 
        class="nav-item {{activeTab === 'feed' ? 'nav-item-active' : ''}}"
        bindtap="switchTab"
        bindtouchstart="onTabTouchStart"
        bindtouchend="onTabTouchEnd"
        data-tab="feed"
        data-index="1"
      >
        <view class="nav-icon-container">
          <text class="nav-icon {{activeTab === 'feed' ? 'icon-active' : 'icon-inactive'}}">ğŸ“‹</text>
        </view>
        <text class="nav-label {{activeTab === 'feed' ? 'text-blue-600' : 'text-gray-600'}}">åŠ¨æ€</text>
      </view>

      <!-- æ”¶è— Tab -->
      <view 
        class="nav-item {{activeTab === 'bookmark' ? 'nav-item-active' : ''}}"
        bindtap="switchTab"
        bindtouchstart="onTabTouchStart"
        bindtouchend="onTabTouchEnd"
        data-tab="bookmark"
        data-index="2"
      >
        <view class="nav-icon-container">
          <text class="nav-icon {{activeTab === 'bookmark' ? 'icon-active' : 'icon-inactive'}}">â­</text>
        </view>
        <text class="nav-label {{activeTab === 'bookmark' ? 'text-blue-600' : 'text-gray-600'}}">æ”¶è—</text>
      </view>

      <!-- æˆ‘çš„ Tab -->
      <view 
        class="nav-item {{activeTab === 'profile' ? 'nav-item-active' : ''}}"
        bindtap="switchTab"
        bindtouchstart="onTabTouchStart"
        bindtouchend="onTabTouchEnd"
        data-tab="profile"
        data-index="3"
      >
        <view class="nav-icon-container">
          <text class="nav-icon {{activeTab === 'profile' ? 'icon-active' : 'icon-inactive'}}">ğŸ‘¤</text>
        </view>
        <text class="nav-label {{activeTab === 'profile' ? 'text-blue-600' : 'text-gray-600'}}">æˆ‘çš„</text>
      </view>
    </view>
  </view>
</view>